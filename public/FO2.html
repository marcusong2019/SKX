<!DOCTYPE html>
<html>
  <head>
    <title>Forward Observer</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script> -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
      AFRAME.registerComponent('log', {
        schema: {type: 'string'},

        init: function () {
          var stringToLog = this.data;
          console.log(stringToLog);
        }
      });
    </script>
    <script>
      const urlParams = new URLSearchParams(window.location.search); // get all parameters from the url
      const code = urlParams.get('game'); //get the variable we want
      console.log("Attempt join game:",code);
      var socket = io('https://observed-fire-simulator.glitch.me/');
      console.log(socket);
      socket.on("connect", () => {console.log("Connected "+socket.id)});
      socket.emit('joinGame', code);   
      //socket.emit('test', code);   
      socket.on("reply", (data) => {console.log(data)});
      
      //socket.on("target", (data) => {console.log(data)});
      socket.on("target", (data) => {handleNewTarget(data)});
      
      function handleNewTarget(tgtNum) {
        console.log(tgtNum);
        if (tgtNum == 1) {
          createTarget1();
          console.log("Creating Target 1");
        } else if (tgtNum == 2) {
          createTarget2();
          console.log("Creating Target 2");
        } else if (tgtNum == 3) {
          createTarget3();
          console.log("Creating Target 3");
        } else if (tgtNum == 4) {
          createTarget4();
          console.log("Creating Target 4");
        } else {
          console.log("request for target failed");
        }
      }
      
      
      function createTarget1() {
        var sceneEl = document.querySelector('a-scene');
        var entityEl = document.createElement('a-entity');
        // Do `.setAttribute()`s to initialize the entity.   
        entityEl.setAttribute('id', 'target1');
        entityEl.setAttribute('gltf-model', '#M2Bradley');
        entityEl.setAttribute('scale', '1 1 1');
        entityEl.setAttribute('rotation', '0 120 0');
        entityEl.setAttribute('position', '100 1.917 100');
        sceneEl.appendChild(entityEl);
        console.log('createTarget');
      }
      
      function createTarget2() {
        var sceneEl = document.querySelector('a-scene');
        var entityEl = document.createElement('a-entity');
        // Do `.setAttribute()`s to initialize the entity.   
        entityEl.setAttribute('id', 'target2');
        entityEl.setAttribute('gltf-model', '#M2Bradley');
        entityEl.setAttribute('scale', '1 1 1');
        entityEl.setAttribute('rotation', '0 120 0');
        entityEl.setAttribute('position', '0 1.917 100');
        sceneEl.appendChild(entityEl);
        console.log('createTarget');
      }
      
      function createTarget3() {
        var sceneEl = document.querySelector('a-scene');
        var entityEl = document.createElement('a-entity');
        // Do `.setAttribute()`s to initialize the entity.   
        entityEl.setAttribute('id', 'target3');
        entityEl.setAttribute('gltf-model', '#T90Tank');
        entityEl.setAttribute('scale', '1 1 1');
        entityEl.setAttribute('rotation', '0 90 0');
        entityEl.setAttribute('position', '-100 0 100');
        sceneEl.appendChild(entityEl);
        console.log('createTarget');
      }
      
      function createTarget4() {
        var sceneEl = document.querySelector('a-scene');
        var entityEl = document.createElement('a-entity');
        // Do `.setAttribute()`s to initialize the entity.   
        entityEl.setAttribute('id', 'target4');
        entityEl.setAttribute('gltf-model', '#T90Tank');
        entityEl.setAttribute('scale', '1 1 1');
        entityEl.setAttribute('rotation', '0 120 0');
        entityEl.setAttribute('position', '-100 0 0');
        sceneEl.appendChild(entityEl);
        console.log('createTarget');
      }   
      
    </script>
  </head>
  <body>
    <a-scene>     
      <!-- Preload assets -->
      <a-assets>
        <a-asset-item
          id="M2Bradley"
          src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2FM2Bradley.glb"
          response-type="arraybuffer"
        ></a-asset-item>
        
        <a-asset-item
          id="T90Tank"      
          src="https://cdn.glitch.com/0140ff64-dac6-408d-bf59-c093dd13ad3a%2FT90.glb?v=1626968225914"
          response-type="arraybuffer"
        ></a-asset-item>
        <!-- https://www.cgtrader.com/items/3127302/download-page -->
        
        <a-asset-item
          id="lowTank"
          src="https://cdn.glitch.com/0140ff64-dac6-408d-bf59-c093dd13ad3a%2Flow_poly_2655945_tank.glb?v=1626967824598"
          response-type="arraybuffer"
        ></a-asset-item>
        
        <img id="sky1" crossorigin="anonymous" src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2F100_3FLY_FLY08001_spherical_0.jpg">
        <img id="crosshair" crossorigin="anonymous" src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2FCrosshair3.png">
        <img id="fire" crossorigin="anonymous" src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2FDaco_4214507.png">
      </a-assets>
      
      <a-entity camera="zoom: 7" look-controls position="0 20 0">
        <a-image src="#crosshair" position="0 0 -1" material="alphaTest: 0.5" scale="0.17 0.15 1"></a-image> <!-- scale 0.14 is 1/7th -->
      </a-entity>
      
      <!-- <a-entity environment="preset: forest; dressingAmount: 500"></a-entity> -->
       <a-sky color="#0FF" radius="2000"></a-sky>
    <a-plane rotation="-90 0 0" width="2000" height="2000" color="#DAF7A6"></a-plane>
      <a-light type="ambient" color="#999999"></a-light>
  <a-light type="point" intensity="2" position="2 4 4"></a-light>
      
      <a-box color="red" depth="10" height="10" width="10" position="1000 5 0"></a-box>
    
      <a-image src="#fire" 
               position="-350 0 350"
               scale="20 20 1"
              material="alphaTest: 0.5" geometry=""
               side="double"
               ></a-image>
      
      
    </a-scene>
  </body>
</html>

