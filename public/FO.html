<!DOCTYPE html>
<html>
  <head>
    <title>Forward Observer</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      AFRAME.registerComponent('log', {
        schema: {type: 'string'},

        init: function () {
          var stringToLog = this.data;
          console.log(stringToLog);
        }
      });
    </script>
    <script>
      const urlParams = new URLSearchParams(window.location.search); // get all parameters from the url
      const code = urlParams.get('game'); //get the variable we want
      console.log("Attempt join game:",code);
      var socket = io('https://observed-fire-simulator.glitch.me/');
      console.log(socket);
      socket.on("connect", () => {console.log("Connected "+socket.id)});
      socket.emit('joinGame', code);   
      //socket.emit('test', code);   
      socket.on("reply", (data) => {console.log(data)});
      
      //socket.on("target", (data) => {console.log(data)});
      socket.on("target", (data) => {handleNewTarget(data)});//{handleNewTarget(data)});
      
      function handleNewTarget(tgtNum) {
        console.log(tgtNum);
        if (tgtNum == 1) {
          createTarget1;
          console.log("Creating Target 1");
        } else if (tgtNum == 2) {
          createTarget2;
          console.log("Creating Target 2");
        } else if (tgtNum == 3) {
          createTarget3;
          console.log("Creating Target 3");
        } else if (tgtNum == 4) {
          createTarget4;
          console.log("Creating Target 4");
        } else {
          console.log("request for target failed");
        }
      }
      
      
      function createTarget1() {
        var sceneEl = document.querySelector('a-scene');
        var entityEl = document.createElement('a-entity');
        // Do `.setAttribute()`s to initialize the entity.   
        entityEl.setAttribute('id', 'target1');
        entityEl.setAttribute('gltf-model', '#M2Bradley');
        entityEl.setAttribute('scale', '5 5 5');
        entityEl.setAttribute('rotation', '0 120 0');
        entityEl.setAttribute('position', '-350 0 350');
        sceneEl.appendChild(entityEl);
        console.log('createTarget');
      }
      function createTarget2() {
        var sceneEl = document.querySelector('a-scene');
        var entityEl = document.createElement('a-entity');
        // Do `.setAttribute()`s to initialize the entity.   
        entityEl.setAttribute('id', 'target1');
        entityEl.setAttribute('gltf-model', '#M2Bradley');
        entityEl.setAttribute('scale', '5 5 5');
        entityEl.setAttribute('rotation', '0 120 0');
        entityEl.setAttribute('position', '-380 0 290');
        sceneEl.appendChild(entityEl);
        console.log('createTarget');
      }
      function createTarget3() {
        var sceneEl = document.querySelector('a-scene');
        var entityEl = document.createElement('a-entity');
        // Do `.setAttribute()`s to initialize the entity.   
        entityEl.setAttribute('id', 'target1');
        entityEl.setAttribute('gltf-model', '#T90Tank');
        entityEl.setAttribute('scale', '5 5 5');
        entityEl.setAttribute('rotation', '0 120 0');
        entityEl.setAttribute('position', '-350 0 350');
        sceneEl.appendChild(entityEl);
        console.log('createTarget');
      }
      function createTarget4() {
        var sceneEl = document.querySelector('a-scene');
        var entityEl = document.createElement('a-entity');
        // Do `.setAttribute()`s to initialize the entity.   
        entityEl.setAttribute('id', 'target1');
        entityEl.setAttribute('gltf-model', '#T90Tank');
        entityEl.setAttribute('scale', '5 5 5');
        entityEl.setAttribute('rotation', '0 120 0');
        entityEl.setAttribute('position', '-380 0 290');
        sceneEl.appendChild(entityEl);
        console.log('createTarget');
      }   
      
    </script>
  </head>
  <body>
    <a-scene>     
      <!-- Preload assets -->
      <a-assets>
        <a-asset-item
          id="M2Bradley"
          src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2FM2Bradley.glb"
          response-type="arraybuffer"
        ></a-asset-item>
        
        <!-- <a-asset-item
          id="T90Tank"
          src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2FT90a.glb"
          response-type="arraybuffer"
        ></a-asset-item> -->
        
        <img id="sky1" crossorigin="anonymous" src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2F100_3FLY_FLY08001_spherical_0.jpg">
        <img id="crosshair" crossorigin="anonymous" src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2FCrosshair3.png">
        <img id="fire" crossorigin="anonymous" src="https://cdn.glitch.com/43148ef6-d50d-4e2d-9f92-9cdadde2d68a%2FDaco_4214507.png">
      </a-assets>
      
      <a-entity camera look-controls>
        <a-image src="#crosshair" position="0 0 -1" material="alphaTest: 0.5"></a-image>
      </a-entity>
      
      <!--a-sky color="#6EBAA7"></a-sky> -->
      <a-sky src="#sky1"></a-sky>
      <a-entity light="color: #BBB; type: ambient; intensity: 3" data-aframe-default-light="" aframe-injected=""></a-entity>
        
      <!--
      <a-entity position="-350 0 350">
        <a-entity
          gltf-model="#M2Bradley"
          scale="5  5  5"
          rotation="0 120 0"      
        >
        </a-entity>      
      </a-entity>
      <a-entity position="-380 0 290">
        <a-entity
          log="Create Bradley"
          gltf-model="#M2Bradley"
          scale="5  5  5"
          rotation="0 120 0"      
        >
        </a-entity>      
      </a-entity>
-->
      
    
    
      <a-image src="#fire" 
               position="-350 0 350"
               scale="20 20 1"
              material="alphaTest: 0.5" geometry=""
               side="double"
               ></a-image>
      
      
    </a-scene>
  </body>
</html>

