<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Observed Fire Trainer</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://netdna.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<style>
#gameScreen {
  display: none;
}
#scenarioScreen {
  display: none;
}  
  
body {font-family: Arial;}

/* Style the tab */
.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid #ccc;
  border-top: none;
}
</style>
</head>
<body>
  <div class="alert alert-warning" role="alert">
  NOTICE: This is a prototype web app that is under active development. Expect changes to occur. You may encounter bugs. Send issues and suggestions to gordon.cooke at westpoint dot edu.
</div>
  
  <section class="vh-100">
    <div class="container h-100">

      <div id="initialScreen" class="h-100">
        <div class="d-flex flex-column align-items-center justify-content-center h-100">
            <h1>Observed Fire Simulator</h1>
            <button
              type="submit"
              class="btn btn-success"
              id="newGameButton"
            >
              Create New FDC
            </button>
            <div>OR</div>
            <div class="form-group">
              <input type="text" placeholder="Enter FDC Code" id="gameCodeInput"/>
            </div>
            <button
              type="submit"
              class="btn btn-success"
              id="joinGameButton"
            >
              Join FDC as Observer
            </button>
          <br/>
          <div> <!-- Instruction area -->
            <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
              Instructions
            </button>
            <div class="collapse" id="collapseExample">
              <div class="card card-body">
                <h4>Overview</h4>
                This simulation requires two users (or at least, two instances of a web browser). One user acts as the Fire Direction Center (FDC) and has control over targets and inputs the fire missions.
                One or more other users connect to the same scenario as Forwar Observers (FO). They will see a 3D rendering of the terrain and can observe round impacts. 
                By communicating with the FDC, the FO can practice requesting and adjusting indirect fire missions.
                
                <h4>Create a new FDC</h4>
                Click the green "Create New FDC" button to create a new training simulation. You will shown the set of available scenarios, select the one you wish to use. 
                You will then be taken to the FDC game screen. The top of the screen has a QR code and game code. Give the game code, or show the QR code, to the forward observer(s).
                
                <h4>Join an FDC as a Forward Observer</h4>
                FOs can either follow a QR code directly to the scenario, or enter the game code and press the green "Join FDC as Observer" button to enter the simulation.
                The screen will briefly be blue as the scenario loads. If the screen hangs on blue for a long time, refresh the page.
                
                <h4>FO View on Desktop</h4>
                You will see the view of the scene from the Observation Point (OP). Pressing the space bar will toggle between your "eye" view and a 7x binocular view. 
                The binoculars have a reticle simualting an M22 binocular. The compas angle is displayed above the reticle (currently in degrees on top, and mils below).
                You can walk using the WASD keys. W to move forward; A for backward, A and D are left and right.

                <h4>
                  FO View on cell phones
                </h4>
                You can tap the screen to toggle between the "eye" and binocular views. Slide your finger to rotate the view left, right, up, or down. Holding you finger on the screen will make you walk forward.

                <h4>
                  FDC Game Controls
                </h4>
                Top of the screen shows the links and code that allow FOs to connect to your FDC. Provide these to you FOs so they can connect to your scenario.
                Below that are tabs fro Grid, Polar, and Correction. Select the tab to provide inputs for that type of fire mission.
                <p>
                  Grid: Enter the MGRS grid coordinate for the requested fire mission. The easting and northing go in seperate boxes. You must use a 6, 8, or 10 digit grid (3, 4, or 5 digits in each box).
                </p>
                <p>
                  Polar: Enter the direction and distance for teh requested fire mission. The app assumes the observer is located at the OP (where they spawned when entering the simulation.)
                </p>
                <p>
                  Correction: Enter the direction of view (in mils) along with the add/drop and left/right information (in meters). The app will adjust frie from the last fire mission's impact point.
                </p>
                <p>
                  Select the type of round to use from the drop down. Press the green Submit button to eecute the fire mission. 
                  The app will send the impact almost immediately. You should press the button just after "Splash, Over".
                </p>
                <p>
                  Targets: There are four target buttons. Pressing them will trun on the targets so your FO can see them. 
                  Note, if you press the same target a second time after the target already exists, this can cause odd behavrios, such as two targets stacked on each other.
                  The target set is differnet fro eachs scenario.
                </p>
                
                <h4>
                  Oculus Quest
                </h4>
                This app has been tested with an Oculus Quest headeset and controllers. Other headsets should work, but this is untested.
                NB: Head mounted displays, like Oculus Quest, are not fully supported. FOs can view the simulation, but do not yet have access to binoculars.
                Load the view link in the Oculus browser. After the scene renders, click the [VR] button in the lower right of the virtual screen to enter VR mode.
                You can move you head to look in different direction. The left thumbstick controls your movement. Up will make you go forward, the direction you are looking. Left and right will slide you left or right.
                Use the Oculus button on the right controller to open a menu and click "Exit" to leave the 360 VR.
                <h4>
                  Comments, Issues, and Suggestions
                </h4>
                This web app is built by the West Point Simulation Center as a working prototype. It certainly has its problems. Send comments to Dr. Gordon Cooke: gordon dot cooke at westpoint dot edu.
                Suggestions for improvement, including feature requests for new use cases, are very welcome.
              </div>
            </div>
      </div> <!-- Instruction area end -->
        </div>
      </div>
      
      <div id="scenarioScreen" class="h-100">
        
        
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3">
          
          <div class="col">        
            <div class="card" style="width: 18rem;">
              <img src="https://cdn.glitch.com/0140ff64-dac6-408d-bf59-c093dd13ad3a%2FU.S._Military_Academy_Coat_of_Arms.svg.png?v=1626658887348" class="card-img-top" alt="West Point Thumbnail" height="200" width="200">
              <div class="card-body">
                <h5 class="card-title">West Point OP McNair</h5>
                <p class="card-text">Example scenario on West Point's artillery range terrain.</p>
                <button class="btn btn-primary" onclick="setScenario('West Point OP McNair')">Select</button>
              </div>
            </div>
          </div>
  
            <div class="col">        
            <div class="card" style="width: 18rem;">
              <img src="https://cdn.glitch.com/ff04fad4-579c-40f2-b2d7-d1a5cf0a03be%2FMapSegment.png?v=1628971820083" class="card-img-top" alt="West Point Thumbnail" height="200" width="200">
              <div class="card-body">
                <h5 class="card-title">Custom Location</h5>
                <p class="card-text"> Enter MGRS grid (include grid zone designator)
                    <div class="form-group">
                      <input type="text" placeholder="18TWL81647945" id="gridInput"/> 
                    </div>
                </p>
                <button disabled class="btn btn-primary" id="sendMgrsGrid">Submit</button>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="card" style="width: 18rem;">
              <img src="https://cdn.glitch.com/0140ff64-dac6-408d-bf59-c093dd13ad3a%2FUSMA%20SSI.jpg?v=1626658973120" class="card-img-top" alt="USMA Patch Thumbnail" height="200" width="200">
              <div class="card-body">
                <h5 class="card-title">Example Sceanrio</h5>
                <p class="card-text">This is an inactive placeholder. Future updates to include a choice of scenarios.</p>
                <button class="btn btn-primary" disabled onclick="setScenario('Test 2')">Select</button>
              </div>
            </div>
          </div>
          
        </div>
      </div>

      <div id="gameScreen" class="h-100">
        <div class="d-flex flex-column align-items-center justify-content-center h-100">

          <div id="qrcodeDisplay"></div>
          <a href="#" id="linkURL" target="_blank">
            <h1>Your game code is: <span id="gameCodeDisplay"></span></h1>
          </a>
          <h2>Scenario: <span id="gameScenarioDisplay"></span></h2>
          <!--<h2><span id="numConnectionsDisplay"></span></h2>-->
          
          <div class="tab">
            <button class="tablinks" onclick="openAdjustFire(event, 'gridTab')" id="defaultOpen">Grid</button>
            <button class="tablinks" onclick="openAdjustFire(event, 'polarTab')">Polar</button>
            <button class="tablinks" onclick="openAdjustFire(event, 'correctionTab')">Correction</button>
          </div>
          
          <div id="gridTab" class="tabcontent">
            <div class="form-group">
                WL <input type="number" min="0" max="99999" placeholder="Easting" id="gridEastingInput"/>
                <input type="number" min="0" max="99999" placeholder="Northing" id="gridNorthingInput"/>
                <! maxlength="5" only works for text input type  >
            </div>
          </div>
          <div id="polarTab" class="tabcontent">
            <div class="form-group">
                <label for="polarDirectionInput">Direction</label>
                <input type="number" min="0" max="6400" placeholder="mils" id="polarDirectionInput"/>
                <label for="polarDistanceInput">Distance</label>
                <input type="number" min="0" max="10000" placeholder="meters" id="polarDistanceInput"/>
            </div>
          </div>
          <div id="correctionTab" class="tabcontent">
            <div class="form-group">
              <table>
                <tr>
                  <th>
                    <label for="shiftDirectionInput">Direction</label>
                  </th><td>
                    <input type="number" min="0" max="6400" placeholder="mils" id="shiftDirectionInput"/>
                  </td>
                </tr>
                <tr>
                  <th>
                  <label for="shiftRangeInput">Range</label>
                    </th><td>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="correctRangeAddDrop" id="correctRangeAdd" value="add" checked>
                    <label class="form-check-label" for="correctRangeAdd">Add</label>
                  </div>
                  </td><td>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="correctRangeAddDrop" id="correctRangeDrop" value="drop">
                    <label class="form-check-label" for="correctRangeDrop">Drop</label>
                  </div>
                  </td><td>
                  <input type="number" min="-1000" max="1000" placeholder="meters" id="shiftRangeInput"/>
                  </td>
                </tr>
                <!br>  
                <tr>
                  <th>
                <label for="shiftDeviationInput">Deviation</label>
                    </th><td>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="correctDevLeftRight" id="correctDevLeft" value="left">
                  <label class="form-check-label" for="correctDevLeft">Left</label>
                </div>
                  </td><td>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="correctDevLeftRight" id="correctDevRight" value="right" checked>
                  <label class="form-check-label" for="correctDevRight">Right</label>
                </div>
                  </td><td>
                <input type="number" min="0" max="1000" placeholder="meters" id="shiftDeviationInput"/>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          
          <div>
            <select id="roundTypeInput">
              <option value="HEPD" selected>High Explosive Quick</option>
              <option value="HEVT">High Explosive Variable Time</option>
              <!--<option value="HED">High Explosive Delay</option>-->
            </select>
            <button
              type="submit"
              class="btn btn-success"
              id="sendFireMission"
            >
              Submit
            </button>
          </div>
          
          <div>
            <h2 style="background-color:red;color:white"><span id="gameHitDisplay"></span></h2>
          </div>
          
          <div class="py-3">
            <button
              type="submit"
              class="btn btn-success"
              id="target1UpButton"
              onclick="requestTarget(1)"
            >
              Target 1
            </button>

            <button
              type="submit"
              class="btn btn-success"
              id="target2UpButton"
              onclick="requestTarget(2)"
            >
              Target 2
            </button>

            <button
              type="submit"
              class="btn btn-success"
              id="target3UpButton"
              onclick="requestTarget(3)"
            >
              Target 3
            </button>

            <button
              type="submit"
              class="btn btn-success"
              id="target4UpButton"
              onclick="requestTarget(4)"
            >
              Target 4
            </button>

          </div>
          
        </div>
      </div>
    </div>
</section>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/qrcode.min.js"></script>
  <script src="/main.js"></script>
</body>
</html>